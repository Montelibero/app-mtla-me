(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[211],{47943:function(){},55024:function(){},31076:function(e,t,a){"use strict";a.d(t,{v:function(){return n},P:function(){return l}});let n={mainAccount:"GCNVDZIHGX473FEI7IXCUAEXUJ4BGCKEMHF36VYP5EMS7PX2QBLAMTLA",mtlapToken:"MTLAP",mtlacToken:"MTLAC"},l=["OneFamily","Spouse","Guardian","Ward","Sympathy","Love","Divorce","A","B","C","D","Employer","Employee","Contractor","Client","Partnership","Collaboration","OwnerMinority","OwnerMajority","Owner","OwnershipFull","OwnershipMajority"]},31219:function(e,t,a){"use strict";a.d(t,{AZ:function(){return k},lx:function(){return x},fY:function(){return D},vP:function(){return M},Y5:function(){return O},VO:function(){return P},Wt:function(){return S},VW:function(){return I},Aj:function(){return useGetTree},Qg:function(){return useLanguageContext},T_:function(){return useTranslations}});var n=a(57437),l=a(69108),o=a(42853),r=a(7006),i=a.n(r),s=a(30954),u=a.n(s),c=a(47520),d=a.n(c),m=a(48911),g=a.n(m),h=a(83705),f=a.n(h),v=a(92166),p=a(2265),C=a(30210),b=a(31076),y=a(26941),w=a(44072);let T=new l.Server("https://horizon.stellar.org"),A=new l.Asset(b.v.mtlapToken,b.v.mainAccount),_=new l.Asset(b.v.mtlacToken,b.v.mainAccount),L=["GDGC46H4MQKRW3TZTNCWUU6R2C7IPXGN7HQLZBJTNQO6TW7ZOS6MSECR"],M=(0,C.sU)({currentC:[],error:null,isLoading:!1,isValidating:!1,mutate:()=>Promise.resolve(void 0)},()=>{let e=(0,o.ZP)("currentC",async()=>{var e,t;let a=JSON.parse((null===(e=localStorage)||void 0===e?void 0:e.getItem("currentC"))||"null"),n=new Date;if(n.setDate(n.getDate()-1),!(!a||!a.data||new Date(a.date).getTime()<n.getTime()))return a.data;{let e=await T.loadAccount(b.v.mainAccount);return null===(t=localStorage)||void 0===t||t.setItem("currentC",JSON.stringify({data:e,date:new Date})),e}},{revalidateOnFocus:!1,revalidateIfStale:!1}),{data:t,error:a,mutate:n,isLoading:l,isValidating:r}=e,i=(0,p.useMemo)(()=>null==t?void 0:t.signers.filter(e=>e.key!==b.v.mainAccount).map(e=>({id:e.key,count:e.weight})).sort((e,t)=>t.count-e.count),[t]);return{currentC:i,error:a,mutate:n,isLoading:l,isValidating:r}}),asyncWhile=async function(e,t){var a;let n=await t();return(e=e.concat(await Promise.all(null==n?void 0:n.records.map(async e=>{try{let t=e.home_domain?await fetch("https://api.stellar.expert/explorer/public/domain-meta?domain=".concat(e.home_domain)):null;return t&&(e.toml=await t.json()),e}catch(t){return e}}))),(null==n?void 0:null===(a=n.records)||void 0===a?void 0:a.length)>0)?await asyncWhile(e,n.next):e},O=(0,C.sU)({data:[],isLoading:!1,isValidating:!1,members:[],mutate:()=>Promise.resolve(void 0),date:null},()=>{var e;let t=JSON.parse((null===(e=localStorage)||void 0===e?void 0:e.getItem("members"))||"null"),a=(null==t?void 0:t.date)||null,n=(0,o.ZP)("members",async()=>{let e=JSON.parse(localStorage.getItem("members")||"null"),t=new Date;if(t.setDate(t.getDate()-1),!(!e||new Date(e.date).getTime()<t.getTime()))return e.data;{var a;let e=[],t=await T.accounts().forAsset(A).call();return e=(e=e.concat(t.records,await asyncWhile(e,t.next))).filter(e=>!L.includes(e.account_id)),null===(a=localStorage)||void 0===a||a.setItem("members",JSON.stringify({data:e,date:new Date})),e}},{revalidateOnFocus:!1,revalidateIfStale:!1}),[l,r]=(0,p.useMemo)(()=>{var e;let t=[],a=[];return null==n||null===(e=n.data)||void 0===e||e.forEach(e=>{var n;let l=atob(e.data_attr.mtla_a_delegate||e.data_attr.mtla_delegate||""),o=atob(e.data_attr.mtla_c_delegate||e.data_attr.mtla_delegate||""),r="ready"===atob(e.data_attr["MTLA Council"]||"")||"ready"===o;""!==l&&a.push(l),""!==o&&"ready"!==o&&o!==e.account_id&&a.push(o),t.push({id:e.account_id,count:Number((null===(n=e.balances.find(e=>"credit_alphanum12"===e.asset_type&&e.asset_code===A.getCode()&&e.asset_issuer===A.getIssuer()))||void 0===n?void 0:n.balance)||0),delegateA:l,delegateC:"ready"!==o&&o!==e.account_id?o:"",councilReady:r})}),[t,a]},[n.data]),[i,s]=(0,p.useState)([]);return(0,p.useEffect)(()=>{(async()=>{let e=u()(g()(r),l,(e,t)=>e===t.id);(null==e?void 0:e.length)>0?s(await enrichMembers(f()(l,"id"),e,10)):s(l)})()},[l,r,a]),{data:n.data,isLoading:n.isLoading,isValidating:n.isValidating,mutate:n.mutate,members:i,date:a}}),D=(0,C.sU)({data:[],isLoading:!1,isValidating:!1,members:[],mutate:()=>Promise.resolve(void 0),date:null},()=>{var e;let t=JSON.parse((null===(e=localStorage)||void 0===e?void 0:e.getItem("сorporateMembers"))||"null"),a=(null==t?void 0:t.date)||null,n=(0,o.ZP)("сorporateMembers",async()=>{let e=JSON.parse(localStorage.getItem("сorporateMembers")||"null"),t=new Date;if(t.setDate(t.getDate()-1),!(!e||new Date(e.date).getTime()<t.getTime()))return e.data;{var a;let e=[],t=await T.accounts().forAsset(_).call();return e=(e=e.concat(await Promise.all(t.records.map(async e=>{try{let t=e.home_domain?await fetch("https://api.stellar.expert/explorer/public/domain-meta?domain=".concat(e.home_domain)):null;return t&&(e.toml=await t.json()),e}catch(t){return e}})),await asyncWhile(e,t.next))).filter(e=>!L.includes(e.account_id)),null===(a=localStorage)||void 0===a||a.setItem("сorporateMembers",JSON.stringify({data:e,date:new Date})),e}},{revalidateOnFocus:!1,revalidateIfStale:!1}),l=(0,p.useMemo)(()=>{var e;let t=[];return null==n||null===(e=n.data)||void 0===e||e.forEach(e=>{var a;t.push({id:e.account_id,count:Number((null===(a=e.balances.find(e=>"credit_alphanum12"===e.asset_type&&e.asset_code===_.getCode()&&e.asset_issuer===_.getIssuer()))||void 0===a?void 0:a.balance)||0),domain:e.home_domain,toml:e.toml})}),t},[n.data]);return{data:n.data,isLoading:n.isLoading,isValidating:n.isValidating,mutate:n.mutate,members:l,date:a}}),useGetTree=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"delegateC",{members:t,isLoading:a,isValidating:l,mutate:o,date:r}=O(),[i,s]=(0,p.useMemo)(()=>{let a;let l=(0,v.arrayToTree)(t,{parentId:e,dataField:null});try{(0,v.arrayToTree)(t,{parentId:e,dataField:null,throwIfOrphans:!0})}catch(t){var o;let e=null===(o=/\[(.+?)\]/.exec(t))||void 0===o?void 0:o[1];a=()=>(0,n.jsxs)(n.Fragment,{children:["В делигациях есть циклические ссылки или ссылки на недействительных участников",e?(0,n.jsxs)(n.Fragment,{children:[" (",(0,y.rU)(e),")"]}):"","!"]})}return[l,a]},[t]);return{tree:i,isLoading:a,isValidating:l,mutate:o,error:s,date:r}},S=(0,C.sU)({newC:[],isLoading:!1,isValidating:!1,mutate:()=>Promise.resolve(void 0),date:null},()=>{let{tree:e,isLoading:t,isValidating:a,mutate:n,date:l}=useGetTree(),o=(0,p.useMemo)(()=>e.filter(e=>e.count>0&&e.councilReady).map(e=>({...e,count:(0,w.zF)(e),delegations:(0,w.zF)(e)-e.count,weight:Math.floor(Math.log10(Math.max((0,w.zF)(e),2)-1)+1)})).sort((e,t)=>t.count-e.count||e.id.localeCompare(t.id)).splice(0,20),[e]);return{newC:o,isLoading:t,isValidating:a,mutate:n,date:l}}),P=(0,C.sU)({newC:[],isLoading:!1,isValidating:!1,mutate:()=>Promise.resolve(void 0),date:null},()=>{let{members:e}=O(),{tree:t,isLoading:a,isValidating:n,mutate:l,date:o}=useGetTree("delegateA"),r=(0,p.useMemo)(()=>f()(t.concat(e),"id").filter(e=>e.count>0).map(e=>({...e,count:(0,w.zF)(e),delegations:(0,w.zF)(e)-e.count,weight:(0,w.Kg)("delegateA",!0,e)})).sort((e,t)=>t.count-e.count||e.id.localeCompare(t.id)),[t]);return{newC:r,isLoading:a,isValidating:n,mutate:l,date:o}}),x=(0,C.sU)({changes:[],isLoading:!1,isValidating:!1,mutate:()=>[Promise.resolve(void 0),Promise.resolve(void 0)],date:null},()=>{let{currentC:e=[],mutate:t,isLoading:a,isValidating:n}=M(),{newC:l,isLoading:o,isValidating:r,mutate:s,date:u}=S(),c=(0,p.useMemo)(()=>{if(!(null==l?void 0:l.length)||!(null==e?void 0:e.length))return[];let t={},a=i()(e,l,"id");a.forEach(e=>t[e.id]=0);let n=i()(l,e,"id");n.forEach(e=>t[e.id]=e.weight);let o=d()(l,e,(e,t)=>e.id===t.id&&e.weight!==t.count);o.forEach(e=>t[e.id]=e.weight);let r=e.reduce((e,t)=>({...e,[t.id]:t.count}),{});return Object.keys(t).map(e=>{var a;let n=null!==(a=r[e])&&void 0!==a?a:0,l=t[e];return{id:e,weight:l,diff:0===n?"новый":l<n?"- ".concat(n-l):"+ ".concat(l-n)}})},[e,l]),m=(0,p.useCallback)(()=>[s(),t()],[s,t]),g=(0,p.useMemo)(()=>o||a,[o,a]),h=(0,p.useMemo)(()=>r||n,[r,n]);return{changes:c,isLoading:g,isValidating:h,mutate:m,date:u}}),enrichMembers=async(e,t,a)=>{let n=[...e],l=[];if(a>0&&(null==t?void 0:t.length)>0){(await Promise.all(t.map(async e=>{var t,a,n;let o=JSON.parse((null===(t=localStorage)||void 0===t?void 0:t.getItem("accounts"))||"null"),r=new Date;r.setDate(r.getDate()-1);let i=null==o?void 0:null===(a=o.data)||void 0===a?void 0:a[e];if(!(!i||new Date(o.date).getTime()<r.getTime()))return i;{let t=await T.loadAccount(e),a=atob(t.data_attr.mtla_a_delegate||t.data_attr.mtla_delegate||""),r=atob(t.data_attr.mtla_c_delegate||t.data_attr.mtla_delegate||"");""!==a&&l.push(a),""!==r&&"ready"!==r&&r!==t.account_id&&l.push(r);let i={id:e,count:0,delegateA:a,delegateC:"ready"!==r&&r!==t.account_id?r:"",removed:!0};return o={data:{...null==o?void 0:o.data,[e]:i},date:new Date},null===(n=localStorage)||void 0===n||n.setItem("accounts",JSON.stringify(o)),i}}))).forEach(e=>n.push(e));let e=u()(g()(l),n,(e,t)=>e===t.id);(null==e?void 0:e.length)>0&&(n=await enrichMembers(n,e,a-1))}return n},I=(0,C.sU)(null,()=>{let{newC:e,isLoading:t}=S(),{changes:a,isLoading:n}=x(),r=(0,o.ZP)((null==e?void 0:e.length)>0&&(null==a?void 0:a.length)>0&&!t&&!n&&"account",()=>T.loadAccount(b.v.mainAccount),{revalidateOnFocus:!1,revalidateIfStale:!1}),i=(0,p.useMemo)(()=>{if(!((null==e?void 0:e.length)>0&&(null==a?void 0:a.length)>0&&!t&&!n))return null;let o=e.reduce((e,t)=>e+t.weight,0),i=Math.floor(o/2+1);if(r.data){let e=new l.TransactionBuilder(r.data,{fee:"100000",networkPassphrase:l.Networks.PUBLIC});e.addMemo(l.Memo.text("Update sign weights"));let t=0,n=a[a.length-1];if(a.forEach(a=>{let o=l.Operation.setOptions({signer:{ed25519PublicKey:l.Keypair.fromPublicKey(a.id).publicKey(),weight:a.weight},...n.id===a.id&&{masterWeight:0,lowThreshold:i,medThreshold:i,highThreshold:i}});e.addOperation(o),t++}),t)return e.setTimeout(l.TimeoutInfinite).build().toEnvelope()}return null},[e,a,t,n,r.data]);return i});a(53052);let k=(0,p.createContext)({locale:"ru",changeLanguage:e=>{}}),useLanguageContext=()=>(0,p.useContext)(k);var E=JSON.parse('{"common":{"title":"Загрузка...","data":"Данные на","buttonTitle":"Обновить"},"assembly":{"name":"Собрание","content":{"members":{"name":"Делегат в Собрании","title":"Индивидуальные участники Ассоциации","tableHead":"Аккаунт"},"delegateTree":"Проверка делегаций для Собрания:","newAssembly":{"title":"Состав Собрания","firstColumn":"Аккаунт","secondColumn":"Токены","thirdColumn":"Голоса"}}},"council":{"name":"Совет","content":{"currentC":{"title":"Актуальный состав Совета","firstColumn":"Аккаунт","secondColumn":"Голоса"},"members":{"name":"Делегат в Совете"},"delegateTree":{"name":"Проверка делегаций для Совета:"},"newC":{"title":"Ожидаемый состав Совета","firstColumn":"Аккаунт","secondColumn":"Токены","thirdColumn":"Голоса"},"changes":{"title":"Разница расчетного и текущего:","firstColumn":"Аккаунт","secondColumn":"Вес голоса","thirdColumn":"Изменения","noChanges":"Нет изменений"}}},"corporate":{"name":"Корпорации","content":{"members":{"title":"Корпоративные участники Ассоциации","secondColumn":"Аккаунт","fourthColumn":"Сайт"}}}}'),N=JSON.parse('{"common":{"title":"Loading...","data":"The data as of","buttonTitle":"Update"},"assembly":{"name":"Assembly","content":{"members":{"name":"Delegate in the Assembly","title":"Individual members of the Association","tableHead":"Account"},"delegateTree":"Delegation check for the Assembly:","newAssembly":{"title":"Composition of the Assembly","firstColumn":"Account","secondColumn":"Tokens","thirdColumn":"Votes"}}},"council":{"name":"Council","content":{"currentC":{"title":"Current composition of the Council","firstColumn":"Account","secondColumn":"Votes"},"members":{"name":"Delegate in the Council"},"delegateTree":{"name":"Delegation check for the Council:"},"newC":{"title":"Expected composition of the Council","firstColumn":"Account","secondColumn":"Tokens","thirdColumn":"Votes"},"changes":{"title":"Difference between calculated and current:","firstColumn":"Account","secondColumn":"Voting weight","thirdColumn":"Changes","noChanges":"No changes"}}},"corporate":{"name":"Corporates","content":{"members":{"title":"Corporate members of the Association","secondColumn":"Account","fourthColumn":"Website"}}}}');let F={en:N,ru:E},useTranslations=()=>{let{locale:e}=useLanguageContext();return F[e]}},53052:function(e,t,a){"use strict";a.d(t,{Z:function(){return useActiveTab}});var n=a(24033);function useActiveTab(){let e=(0,n.useSearchParams)(),t=e.get("activeTab")||"assembly";return t}},44072:function(e,t,a){"use strict";a.d(t,{dY:function(){return filterTableData},vA:function(){return getUniqueSelectOptions},mu:function(){return setByLevel},my:function(){return setOnlyAssociationMembers},Pj:function(){return sortTags},zF:function(){return sumCount},Kg:function(){return sumWeight}});let sumCount=e=>{var t,a;return e?(e.count>1?e.count:0)+ +((null===(t=e.children)||void 0===t?void 0:t.length)?null===(a=e.children)||void 0===a?void 0:a.map(sumCount).reduce((e,t)=>e+t,0):0):0},sumWeight=(e,t,a)=>{var n,l;return a?(a[e]&&t?0:a.count>1?1:0)+ +((null===(n=a.children)||void 0===n?void 0:n.length)?null===(l=a.children)||void 0===l?void 0:l.map(sumWeight.bind(null,e,!1)).reduce((e,t)=>e+t,0):0):0},getUniqueSelectOptions=(e,t)=>{let a=new Set;return e.forEach(e=>{e[t]&&a.add(e[t])}),Array.from(a).map(e=>e)};var n=a(31076);let sortTags=(e,t)=>{let a=n.P.indexOf(e),l=n.P.indexOf(t);return -1!==a&&-1!==l?a-l:-1!==a?-1:-1!==l?1:0},filterTableData=e=>{let t=[];return!e.state.source||e.state.tag||e.state.goal||e.tableData.forEach(a=>a.source===e.state.source&&t.push(a)),e.state.source&&!e.state.tag&&e.state.goal&&e.tableData.forEach(a=>a.source===e.state.source&&a.goal===e.state.goal&&t.push(a)),e.state.source||e.state.tag||!e.state.goal||e.tableData.forEach(a=>a.goal===e.state.goal&&t.push(a)),e.state.source||!e.state.tag||e.state.goal||e.tableData.forEach(a=>a.tag===e.state.tag&&t.push(a)),e.state.source&&e.state.tag&&!e.state.goal&&e.tableData.forEach(a=>a.source===e.state.source&&a.tag===e.state.tag&&t.push(a)),e.state.source&&e.state.tag&&e.state.goal&&e.tableData.forEach(a=>a.source===e.state.source&&a.tag===e.state.tag&&a.goal===e.state.goal&&t.push(a)),t},setOnlyAssociationMembers=e=>{let t=e.filter(e=>e.tokens.hasOwnProperty("MTLAP")||e.tokens.hasOwnProperty("MTLAC"));return t},setByLevel=e=>1===e.level?filteredByLevel(e.fields,1,2):2===e.level?filteredByLevel(e.fields,2,3):3===e.level?filteredByLevel(e.fields,3,4):4===e.level?filteredByLevel(e.fields,4,5):5===e.level?filteredByLevel(e.fields,5):[],filteredByLevel=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,n=e.filter(e=>{if(e.tokens.MTLAP){let n=parseFloat(e.tokens.MTLAP);return n>=t&&n<a}if(e.tokens.MTLAC){let n=parseFloat(e.tokens.MTLAC);return n>=t&&n<a}});return n}},26941:function(e,t,a){"use strict";a.d(t,{rU:function(){return Link},aN:function(){return Loader},OK:function(){return Tab},I5:function(){return TabContent}});var n=a(57437);let Link=e=>e?(0,n.jsx)("a",{href:"https://stellar.expert/explorer/public/account/".concat(e),target:"_blank",className:"stellar_address",children:e.replace(e.substring(4,e.length-4),"...")}):null;var l=a(53052),o=a(61396),r=a.n(o);let Tab=e=>{let{id:t,name:a}=e,o=(0,l.Z)();return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(r(),{href:"?activeTab=".concat(t),className:"tab ".concat(o===t?"selected":""),children:a})})},TabContent=e=>{let{id:t,Component:a}=e,o=(0,l.Z)();return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(a.type,{...a.props,className:"tab-content ".concat(o===t?"selected":"")})})};var i=a(31219);let Loader=()=>()=>{let e=(0,i.T_)();return(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:(0,n.jsx)("div",{children:e.common.title})})}}}]);